# ğŸ“ Arquitectura de Software Integral
## Sistema de GestiÃ³n â€” FundaciÃ³n 100% San AgustÃ­n
### Node.js + Express + MongoDB | PatrÃ³n MVC

---

## 1. Estructura de Directorios (Actual â†’ Profesional)

```
excalibur-sd3-activity/
â”‚
â”œâ”€â”€ config/                         # âš™ï¸  ConfiguraciÃ³n centralizada
â”‚   â””â”€â”€ database.js                 # ConexiÃ³n a MongoDB con validaciÃ³n
â”‚
â”œâ”€â”€ controllers/                    # ğŸ® Capa de Control (MVC)
â”‚   â”œâ”€â”€ beneficiary.controller.js   # CRUD + bÃºsqueda
â”‚   â”œâ”€â”€ activity.controller.js      # CRUD + filtro por Ã¡rea
â”‚   â”œâ”€â”€ volunteer.controller.js     # CRUD
â”‚   â”œâ”€â”€ resource.controller.js      # CRUD
â”‚   â””â”€â”€ attendance.controller.js    # CRUD + populate (joins)
â”‚
â”œâ”€â”€ models/                         # ğŸ—„ï¸  Capa de Modelo (MVC) â€” Schemas Mongoose
â”‚   â”œâ”€â”€ Beneficiary.js
â”‚   â”œâ”€â”€ Activity.js
â”‚   â”œâ”€â”€ Volunteer.js
â”‚   â”œâ”€â”€ Resource.js
â”‚   â””â”€â”€ Attendance.js
â”‚
â”œâ”€â”€ routes/                         # ğŸ›£ï¸  Enrutamiento
â”‚   â”œâ”€â”€ beneficiary.routes.js
â”‚   â”œâ”€â”€ activity.routes.js
â”‚   â”œâ”€â”€ volunteer.routes.js
â”‚   â”œâ”€â”€ resource.routes.js
â”‚   â””â”€â”€ attendance.routes.js
â”‚
â”œâ”€â”€ views/                          # ğŸ–¼ï¸  Capa de Vista (MVC) â€” Templates EJS
â”‚   â”œâ”€â”€ partials/
â”‚   â”‚   â”œâ”€â”€ header.ejs
â”‚   â”‚   â””â”€â”€ footer.ejs
â”‚   â”œâ”€â”€ beneficiarios/
â”‚   â”œâ”€â”€ actividades/
â”‚   â”œâ”€â”€ voluntarios/
â”‚   â”œâ”€â”€ recursos/
â”‚   â”œâ”€â”€ asistencias/
â”‚   â”œâ”€â”€ index.ejs
â”‚   â””â”€â”€ 404.ejs
â”‚
â”œâ”€â”€ public/                         # ğŸ“¦ Assets estÃ¡ticos (CSS, JS, imÃ¡genes)
â”‚   â””â”€â”€ css/style.css
â”‚
â”œâ”€â”€ .env                            # ğŸ”’ Variables de entorno (NO subir a GitHub)
â”œâ”€â”€ .env.example                    # ğŸ“„ Plantilla pÃºblica del .env
â”œâ”€â”€ .gitignore                      # ğŸš« Archivos excluidos de Git
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ server.js                       # ğŸš€ Punto de entrada de la aplicaciÃ³n
```

---

## 2. PatrÃ³n MVC â€” Flujo de una PeticiÃ³n

```
Cliente (Browser)
       â”‚
       â”‚  HTTP Request (GET /beneficiarios)
       â†“
   server.js  â”€â”€â†’  routes/beneficiary.routes.js
                              â”‚
                              â”‚  Llama al mÃ©todo del controlador
                              â†“
                  controllers/beneficiary.controller.js
                              â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                        â”‚
                  â†“                        â†“
           models/Beneficiary.js     (lÃ³gica de negocio)
           (Mongoose â†’ MongoDB)
                  â”‚
                  â†“
           Datos obtenidos de la BD
                  â”‚
                  â†“
           res.render('beneficiarios/index', { datos })
                  â”‚
                  â†“
           views/beneficiarios/index.ejs
                  â”‚
                  â†“
           HTML renderizado â†’ Cliente
```

---

## 3. Convenciones de Nombres (EstÃ¡ndar de la Industria)

| Capa        | ConvenciÃ³n          | Ejemplo                        |
|-------------|---------------------|--------------------------------|
| Models      | `PascalCase.js`     | `Beneficiary.js`               |
| Controllers | `entity.controller.js` | `beneficiary.controller.js` |
| Routes      | `entity.routes.js`  | `beneficiary.routes.js`        |
| Config      | `descripcion.js`    | `database.js`                  |
| Views       | `accion.ejs`        | `crear.ejs`, `editar.ejs`      |
| CSS/JS      | `kebab-case`        | `main-style.css`               |

### MÃ©todos de Controladores (RESTful naming)
| AcciÃ³n       | MÃ©todo recomendado     |
|--------------|------------------------|
| Listar todos | `getAll`               |
| Ver uno      | `getById`              |
| Mostrar form crear | `showCreateForm` |
| Crear        | `create`               |
| Mostrar form editar | `showEditForm` |
| Actualizar   | `update`               |
| Eliminar     | `remove`               |
| Buscar/filtrar | `search`             |

---

## 4. Capas de la Arquitectura â€” Responsabilidades

### ğŸ—„ï¸ Model (Mongoose Schema)
- **Responsabilidad**: Definir la estructura de datos + validaciones
- **NO debe**: Contener lÃ³gica de negocio ni cÃ³digo HTTP
```js
// âœ… Correcto: validaciones declarativas
cedula: { type: String, required: true, unique: true, trim: true }

// âŒ Incorrecto en el modelo: lÃ³gica de negocio
exports.buscarPorCedula = async (cedula) => { ... }  // Esto va en el controller
```

### ğŸ® Controller
- **Responsabilidad**: Recibir la peticiÃ³n HTTP, interactuar con el Model, enviar la respuesta
- **NO debe**: Tener lÃ³gica de BD compleja (va en el Model) ni HTML (va en la Vista)
```js
// âœ… PatrÃ³n correcto: try/catch en cada mÃ©todo
exports.getAll = async (req, res) => {
    try {
        const items = await Model.find();
        res.render('vista/index', { items });
    } catch (error) {
        console.error(error);
        res.status(500).render('500', { message: error.message });
    }
};
```

### ğŸ›£ï¸ Routes
- **Responsabilidad**: Mapear URLs a mÃ©todos del controlador
- **NO debe**: Contener lÃ³gica, solo importar y delegar
```js
// âœ… Correcto: solo delega al controlador
router.get('/', ctrl.getAll);
router.post('/crear', ctrl.create);
```

### âš™ï¸ Config
- **Responsabilidad**: ConfiguraciÃ³n de servicios externos (BD, mail, etc.)
- **Validar** variables de entorno aquÃ­, NO en server.js

### ğŸ–¼ï¸ Views (EJS)
- **Responsabilidad**: Presentar datos al usuario
- **NO debe**: Contener lÃ³gica de negocio compleja

---

## 5. Variables de Entorno â€” Regla de Oro

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   .env (real, privado)     .env.example (pÃºblico)   â”‚
â”‚   âœ… En .gitignore          âœ… Subido a GitHub       â”‚
â”‚   Contiene valores reales   Contiene plantilla       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**El nombre de la variable DEBE ser idÃ©ntico en los 3 lugares:**
1. `.env` â†’ `MONGODB_URI=mongodb+srv://...`
2. `config/database.js` â†’ `process.env.MONGODB_URI`
3. `.env.example` â†’ `MONGODB_URI=<tu_uri_aqui>`

---

## 6. Mejoras Recomendadas (PrÃ³ximos pasos)

### ğŸ”´ Prioritarias (para calidad acadÃ©mica)
1. **Agregar pÃ¡gina de error 500** â€” Vista `views/500.ejs`
2. **Datos de prueba (seed)** â€” Script `scripts/seed.js` para poblar la BD
3. **Capturas MongoDB Atlas** â€” Para el documento PDF de entrega

### ğŸŸ¡ Intermedias (buenas prÃ¡cticas)
4. **ValidaciÃ³n en el lado servidor** â€” Verificar datos antes de guardar
   ```js
   // En el controller, antes del .create():
   if (!nombre || !cedula) return res.render('crear', { error: 'Campos requeridos' });
   ```
5. **Mensajes Flash** â€” Instalar `connect-flash` para mensajes de Ã©xito/error
   ```bash
   npm install connect-flash express-session
   ```
6. **PaginaciÃ³n** â€” Para listas largas: `Beneficiary.find().limit(10).skip(page * 10)`

### ğŸŸ¢ Avanzadas (production-ready)
7. **Helmet.js** â€” Seguridad HTTP headers: `npm install helmet`
8. **Morgan** â€” Logger HTTP: `npm install morgan`
9. **Nodemon** â€” Reinicio automÃ¡tico en desarrollo: `npm install -D nodemon`
   ```json
   // package.json
   "scripts": {
     "dev": "nodemon server.js",
     "start": "node server.js"
   }
   ```

---

## 7. Checklist Final para la Entrega

- [ ] âœ… 5 colecciones en MongoDB (verificar en Atlas/Compass)
- [ ] âœ… CRUD completo en los 5 mÃ³dulos
- [ ] âœ… Consulta personalizada implementada
- [ ] âœ… ConexiÃ³n a MongoDB funcional
- [ ] âœ… `npm install` + `npm start` documentado en README
- [ ] â³ Capturas de pantalla de las colecciones en MongoDB Atlas
- [ ] â³ Captura de la conexiÃ³n exitosa
- [ ] â³ PDF documentado con nombre y apellido
- [ ] â³ Repositorio GitHub actualizado con `git push`

---

## 8. Comandos de Mantenimiento Git

```bash
# Ver archivos modificados
git status

# Agregar todos los cambios
git add .

# Confirmar con mensaje descriptivo
git commit -m "feat: complete MVC architecture with 5 modules"

# Subir a GitHub
git push origin main
```

> ğŸ“Œ **Nota**: La variable `MONGODB_URI` en `.env` es el Ãºnico punto de configuraciÃ³n
> de la BD. Si el URI cambia (p. ej. en Vercel), solo actualiza esa variable, 
> sin tocar el cÃ³digo fuente.
